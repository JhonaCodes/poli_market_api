# ========================================
# PoliMarket API - Docker Compose
# ========================================
# NOTA: Este compose NO incluye PostgreSQL
# La base de datos debe estar en un contenedor externo
#
# Uso:
#   docker-compose up -d    # Iniciar API
#   docker-compose logs -f  # Ver logs
#   docker-compose down     # Detener
# ========================================

services:
  polimarket_api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: polimarket_api

    # Puerto (host:container)
    ports:
      - "${SERVER_PORT:-8080}:8080"

    # Variables de entorno (desde .env)
    environment:
      # Database (OBLIGATORIO)
      DATABASE_URL: ${DATABASE_URL}

      # Server (OPCIONAL)
      SERVER_HOST: ${SERVER_HOST:-0.0.0.0}
      SERVER_PORT: ${SERVER_PORT:-8080}

      # Logging (OPCIONAL)
      RUST_LOG: ${RUST_LOG:-info}
      RUST_BACKTRACE: ${RUST_BACKTRACE:-1}

      # Pool (OPCIONAL)
      POOL_MAX_SIZE: ${POOL_MAX_SIZE:-10}
      POOL_MIN_IDLE: ${POOL_MIN_IDLE:-2}
      POOL_TIMEOUT_SECONDS: ${POOL_TIMEOUT_SECONDS:-30}

    # Red externa (ajustar según tu configuración)
    # networks:
    #   - external-network

    restart: on-failure

    # Límites de recursos
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

# Si usas red externa, descomenta:
# networks:
#   external-network:
#     external: true
